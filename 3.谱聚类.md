## è°±èšç±»

### æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µ

æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„åº”ç”¨åœºæ™¯éå¸¸ä¸°å¯Œï¼Œ åŒ…æ‹¬Sectral Clusteringã€Graph Fourier TransformationåŠGraph Convolutionçš„å®šä¹‰éƒ½ç”¨åˆ°å›¾çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µã€‚

å¯¹äºå›¾$G=(V, E)$,å…¶æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µçš„å®šä¹‰ä¸º$L=D-A$ï¼Œå…¶ä¸­$L$ä¸ºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µï¼Œ $D$ä¸ºé¡¶ç‚¹åº¦çŸ©é˜µï¼Œ$A$æ˜¯å›¾çš„é‚»æ¥çŸ©é˜µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](/Users/mingchao.chen/OneDrive/å­¦ä¹ /ç¬”è®°/picture/matrixforgraph.png)

ä½†éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ å¸¸è§çš„æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µè¡¨ç¤ºå®é™…ä¸Šæœ‰ä¸‰ç§ï¼š
$$
\left\{
\begin{array}
\\
L=D-A\\
L_{sym}=D^{-\frac12}LD^{\frac12}\\
L_{rw}=D^{-1}L     
\end{array}
\right.
$$
å®¹æ˜“æ¨å¯¼çš„æ˜¯ï¼Œæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæœ‰å¦‚ä¸‹æ€§è´¨ï¼š

1. å¯¹ä»»æ„å‘é‡$f\in \mathbb{R}_n$, æ»¡è¶³ï¼š
   $$
   f^TLf=\frac12\sum_{i,j=1}^{n}a_{ij}(f_i-f_j)^2 \label{sc1}
   $$

2. $L$çš„ç‰¹å¾å€¼å‡ä¸ºå®æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ‹‰æ™®æ‹‰æ–¯çŸ©é˜µä¸€å®šæ˜¯å®å¯¹ç§°çŸ©é˜µçš„ç‰¹æ€§å†³å®šçš„

3. æ‹‰æ™®æ‹‰æ–¯çŸ©é˜µæ˜¯åŠæ­£å®šçš„ï¼Œä¸”å¯¹åº”çš„nä¸ªå®æ•°ç‰¹å¾å€¼éƒ½å¤§äºç­‰äº0ï¼Œå³$0=\lambda_1â‰¤\lambda_2â‰¤...â‰¤\lambda_n$ï¼Œ ä¸”æœ€å°çš„ç‰¹å¾å€¼ä¸º0ï¼Œè¿™ä¸ªç”±æ€§è´¨2å¾ˆå®¹æ˜“å¾—å‡ºã€‚

### æ— å‘å›¾åˆ‡å›¾æ–¹æ³•

å¯¹äºæ— å‘å›¾$G$çš„åˆ‡å›¾ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯å°†å›¾$G(V,E)$åˆ‡æˆç›¸äº’æ²¡æœ‰è¿æ¥çš„kä¸ªå­å›¾ï¼Œæ¯ä¸ªå­å›¾ç‚¹çš„é›†åˆä¸ºï¼š$A_1,A_2...A_k$ï¼Œå®ƒä»¬æ»¡è¶³$A_i\cap A_j =\empty$, ä¸”$A_1\cup ğ´_2 \cup...\cupğ´_ğ‘˜=ğ‘‰$ã€‚

å¯¹äºä»»æ„ä¸¤ä¸ªå­å›¾çš„é›†åˆ$A,B\in V$ï¼Œå®šä¹‰$A$å’Œ$B$çš„åˆ‡å›¾æƒé‡ä¸º:
$$
W(A,B)=\sum_{i\in A,j\in B}a_{ij}
$$

å¯¹äº$k$ä¸ªå­å›¾ç‚¹çš„é›†åˆï¼Œ$\{A_1,A_2...A_k\}$ï¼Œå®šä¹‰å…¶åˆ‡å›¾æƒé‡ä¸º:
$$
cut(A_1,A_2...A_K)=\frac12\sum_{i=1}^kW(A_i, 	\bar A_i)
$$
æˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ç§åˆ‡å›¾æ–¹å¼ï¼Œæœ€å¤§åŒ–å­å›¾å†…éƒ¨çš„ç‚¹æƒé‡(åº¦)ä¹‹å’Œï¼Œå¹¶æœ€å°åŒ–å­å›¾é—´çš„ç‚¹æƒé‡(åº¦)å’Œã€‚ä½†æ˜¯è¿™ç§æå°åŒ–çš„åˆ‡å›¾å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š

![img](/Users/mingchao.chen/OneDrive/å­¦ä¹ /ç¬”è®°/picture/cutgraph.jpg)



æˆ‘ä»¬é€‰æ‹©ä¸€ä¸ªæƒé‡æœ€å°çš„è¾¹ç¼˜çš„ç‚¹ï¼Œæ¯”å¦‚Cå’ŒHä¹‹é—´è¿›è¡Œcutï¼Œè¿™æ ·å¯ä»¥æœ€å°åŒ–$cut(A_1,A_2...A_K)$, ä½†æ˜¯å´ä¸æ˜¯æœ€ä¼˜çš„åˆ‡å›¾ã€‚



### åˆ‡å›¾èšç±»

#### RatioCut

RatioCutåˆ‡å›¾ä¸ºäº†é¿å…æœ€å°åˆ‡å›¾ï¼Œå¯¹æ¯ä¸ªåˆ‡å›¾ï¼Œä¸å…‰è€ƒè™‘æœ€å°åŒ–$cut(A_1,A_2...A_K)$,å®ƒè¿˜åŒæ—¶è€ƒè™‘æœ€å¤§åŒ–æ¯ä¸ªå­å›¾ç‚¹çš„ä¸ªæ•°ï¼Œå³ï¼š
$$
RatioCut(A_1,A_2...A_K)=\sum_{i=1}^k \frac{W(A_i, 	\bar A_i)}{|A_i|}
$$
ä¸ºäº†æœ€å°åŒ–è¿™ä¸ª$RatioCut$å€¼ï¼Œ æ ¹æ®å¼$\eqref{sc1}$ï¼Œå¼•å…¥å¦‚ä¸‹æŒ‡ç¤ºå‘é‡$h_j=[h_{1j},h_{2j}...h_{nj}]^T$,
$$
h_{ij}=
\left\{
\begin{array}
\\
0\\
\frac{1}{\sqrt{|A_j|}},v_i\in A_j
\end{array}
\right.
\\
(i=1,2,...n; j=1,2...k)
$$
æ„é€ çŸ©é˜µ$H_{n*k}$, kä¸ªæŒ‡ç¤ºå‘é‡ä½œä¸ºçŸ©é˜µçš„åˆ—,æ ¹æ®å¼$\eqref{sc1}$å®¹æ˜“å¾—åˆ°ï¼š
$$
\begin{aligned}\label{sc2}
\\ 
h_j^TLh_j&=\frac12\sum_{x,y=1}^{n}a_{xy}(h_{xj}-h_{yj})^2\\
&=\frac12(\sum_{x\in A_j,y\notin A_j}a_{xy}(\frac{1}{\sqrt{|A_j|}}-0)^2+\sum_{x\notin A_j,y\in A_j}a_{xy}(0-\frac{1}{\sqrt{|A_j|}})^2)\\

&=\frac12(\sum_{x\in A_j,y\notin A_j}a_{xy}\frac{1}{|A_j|}+\sum_{x\notin A_j,y\in A_j}a_{xy}\frac{1}{|A_j|})\\

&=\sum_{x\in A_j,y\notin A_j}a_{xy}\frac{1}{|A_j|}\\
&=\frac{W(A_j, \bar A_j)}{|A_j|}
\end{aligned}
$$
æ‰€ä»¥
$$
\begin{aligned}
RatioCut(A_1,A_2...A_K)&=\sum_{i=1}^k \frac{W(A_i, 	\bar A_i)}{|A_i|}
\\
&=\sum_{i=1}^k h_i^TLh_i\\
&=tr(H^TLH)
\end{aligned}
$$
å…¶ä¸­$tr(H^TLH)$ä¸ºçŸ©é˜µçš„è¿¹ï¼Œ æ‰€ä»¥æˆ‘ä»¬çš„ç›®æ ‡å‡½æ•°ä¸º:
$$
\arg\min{tr(H^TLH)} \qquad \mathrm{ s.t. }H^TH=I
$$

$$
\because h_i^Th_i=1\\
\therefore ä»¤ h_i^TLh_i=\lambda\\
\Rightarrow Lh_i=\lambda h_i
$$

$h$æ˜¯å•ä½æ­£äº¤åŸºï¼Œ $L$ä¸ºå¯¹ç§°çŸ©é˜µï¼Œæ­¤æ—¶$h_i^TLh_i$çš„æœ€å¤§å€¼ä¸º$L$çš„æœ€å¤§ç‰¹å¾å€¼ï¼Œæœ€å°å€¼æ˜¯$L$çš„æœ€å°ç‰¹å¾å€¼ã€‚$h$æ˜¯å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œ $H$çš„$k$åˆ—å¯¹åº”çš„æ˜¯$L$å‰$k$ä¸ªç‰¹å¾å€¼å¯¹åº”çš„ç‰¹å¾å‘é‡ã€‚åªéœ€è¦å¯¹å¾—åˆ°çš„$H$åšä¸€ä¸ªä¼ ç»Ÿçš„èšç±»ï¼Œ å°±å¯ä»¥å¾—åˆ°èŠ‚ç‚¹æ‰€å±çš„é›†åˆã€‚

#### NCutåˆ‡å›¾

NCutåˆ‡å›¾å’ŒRatioCutåˆ‡å›¾å¾ˆç±»ä¼¼ï¼Œä½†æ˜¯æŠŠRatiocutçš„åˆ†æ¯$|A_i|$æ¢æˆ$vol(A_i)$ã€‚ $vol(A_i)$è¡¨ç¤º$A_i$ä¸­çš„èŠ‚ç‚¹åº¦ä¹‹å’Œã€‚ä¸€èˆ¬æ¥è¯´NCutåˆ‡å›¾ä¼˜äºRatioCutåˆ‡å›¾ã€‚
$$
NCut(A_1,A_2...A_k)=\sum_{i=1}^k \frac{W(A_i, 	\bar A_i)}{vol(A_i)}
$$
NCutçš„æŒ‡ç¤ºå‘é‡ä¸º:
$$
h_{ij}=
\left\{
\begin{array}
\\
0\\
\frac{1}{vol(A_j)},v_i\in A_j
\end{array}
\right.
\\
(i=1,2,...n; j=1,2...k)
$$
åŒRatioCutæ¨å¯¼å¼,
$$
\begin{aligned}\label{sc3}
\\ 
h_j^TLh_j&=\frac12\sum_{x,y=1}^{n}a_{xy}(h_{xj}-h_{yj})^2\\
&=\frac12(\sum_{x\in A_j,y\notin A_j}a_{xy}(\frac{1}{\sqrt{vol(A_j)}}-0)^2+\sum_{x\notin A_j,y\in A_j}a_{xy}(0-\frac{1}{\sqrt{vol(A_j)}})^2)\\

&=\frac12(\sum_{x\in A_j,y\notin A_j}a_{xy}\frac{1}{vol(A_j)}+\sum_{x\notin A_j,y\in A_j}a_{xy}\frac{1}{vol(A_j)})\\

&=\sum_{x\in A_j,y\notin A_j}a_{xy}\frac{1}{vol(A_j)}\\
&=\frac{W(A_j, \bar A_j)}{vol(A_j)}
\end{aligned}
$$

$$
\therefore
NCut(A_1,A_2...A_K)
=\sum_{i=1}^k \frac{W(A_i, 	\bar A_i)}{vol(A_i)}
=\sum_{i=1}^k h_i^TLh_i
=tr(H^TLH)
$$

ä½†æ˜¯å’ŒRatioCutä¸åŒçš„æ˜¯ï¼Œ æ­¤æ—¶$H^TH\not=I, H^TDH=I$,æ¨å¯¼å¦‚ä¸‹ï¼š
$$
h^T_jDh_j=\sum_{i=1}^nh_{ij}^2d_i=\frac{1}{vol(A_j)}\sum_{i\in A_j}d_i=1
\\ \Rightarrow H^TDH=I
$$
æ­¤æ—¶ï¼Œ ä»¤$F=D^{\frac{1}{2}}H, H=D^{-\frac{1}{2}}F$,åˆ™$ F^TF=H^TD^{\frac{1}{2}}D^{\frac{1}{2}}H=I $, è€Œ$H^TLH=F^TD^{-\frac{1}{2}}LD^{-\frac{1}{2}}F=F^TL_{sym}F$, åŒRatioCut,åªéœ€è¦æ±‚å‡º$L_{sym}$å¯¹åº”çš„ç‰¹å¾å€¼å’Œç‰¹å¾å‘é‡å³å¯ã€‚



#### Demo

##### pythonç¤ºä¾‹ä»£ç 

```python
from sklearn.cluster import SpectralClustering
import torch
import networkx as nx
from sklearn.cluster import KMeans
import seaborn as sns

# è·å¾—ç©ºæ‰‹é“ä¿±ä¹éƒ¨æ•°æ®
G = nx.karate_club_graph()
real_tag = [0 if G.nodes[node]['club'] == 'Mr. Hi' else 1 for node in G.nodes]
nx.draw_networkx(G, node_color=real_tag)

# æ·»åŠ è‡ªè¿æ¥è¾¹
A = torch.FloatTensor(nx.adjacency_matrix(G).todense())
A = A + torch.eye(A.size(0))
d = A.sum(1)
L = torch.diag(d) - A


D = torch.diag(torch.pow(d, -0.5))
L_normed_L = D.mm(L).mm(D)

# ### è®¡ç®—RatioCut
eigenvalue, featurevector = torch.eig(L, eigenvectors=True)
eigenvalue1 = eigenvalue[:, 0]
sns.scatterplot(x=range(34), y=eigenvalue1[eigenvalue1.argsort()], hue=real_tag)
features_list = featurevector[:, eigenvalue1.argsort()[1:3]]
std_list = torch.std(features_list, dim=1, keepdim=True)
mean_list = torch.mean(features_list, 1, keepdim=True)
H = (features_list-mean_list)/std_list

sp_kmeans = KMeans(n_clusters=2).fit(H)
sp_kmeans.labels_
nx.draw_networkx(G, node_color=sp_kmeans.labels_)


# ### ä½¿ç”¨Ncut åˆ‡å›¾

eigenvalue, featurevector = torch.eig(L_normed_L, eigenvectors=True)

eigenvalue1 = eigenvalue[:, 0]
sns.scatterplot(x=range(34), y=eigenvalue1[eigenvalue1.argsort()], hue=real_tag)
features_list = featurevector[:, eigenvalue1.argsort()[:2]]
sp_kmeans = KMeans(n_clusters=2).fit(features_list)
sp_kmeans.labels_
nx.draw_networkx(G, node_color=sp_kmeans.labels_)

# ### scikitçš„åŒ…
sc = SpectralClustering(2, affinity='precomputed', n_init=100).fit(A)
nx.draw_networkx(G, node_color=sc.labels_)
```

##### çœŸå®å€¼

![image-20210511114805992](/Users/mingchao.chen/OneDrive/å­¦ä¹ /ç¬”è®°/picture/image-20210511114805992.png)

##### RatioCutç»“æœ

![image-20210511114823755](/Users/mingchao.chen/OneDrive/å­¦ä¹ /ç¬”è®°/picture/image-20210511114823755.png)

##### NCutç»“æœ

![image-20210511114838614](/Users/mingchao.chen/OneDrive/å­¦ä¹ /ç¬”è®°/picture/image-20210511114838614.png)